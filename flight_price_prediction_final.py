# -*- coding: utf-8 -*-
"""flight_price_prediction_final.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1aGj7gij76Z_0rH7ntYlk2Xi6TCqNpdep

## 1- import libraries | Get dataset
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import plotly.express as px
from sklearn.preprocessing import LabelEncoder
import scipy.stats as stats

import plotly.graph_objects as go
import warnings
warnings.filterwarnings("ignore")

df=pd.read_csv("/content/Clean_Dataset.csv")
df

"""## 2- Data Overview & Quality Check

"""

df.head(20)

df.tail(20)

"""##3- processing data

"""

df.drop(columns='Unnamed: 0' ,inplace=True)

""" Data Exploration"""

df.info()

df.dtypes

df.shape

df.columns.to_list()

for column in df.columns:
  if df[column].dtype =='object':
    print(str(column)+ ' is '+str(df[column].unique()))
    print(df[column].value_counts())
    print('******************************************************')

df.describe(include='O' ).T

df.describe().T

df.isnull().sum()

for i in df.select_dtypes(include='O').columns:
    print(df[i].value_counts())
    print()

for i in df.select_dtypes(include='O').columns:
    print(df[i].value_counts(normalize=True)*100)
    print()

for i in df.select_dtypes(exclude='O').columns:
    print(df[i].value_counts(normalize=True)*100)
    print()

df.isna().values.any()

df.duplicated().sum()

sns.heatmap(df.isnull())

"""Insights:

Dataset includes pricing, airline, class, route, stops, and time-related features.

Price distribution shows large variability ‚Üí opportunity for price optimization.

Revenue Actions:

High price variability supports dynamic pricing strategies instead of fixed pricing.

# Price Distribution Analysis
"""

corr_data=df.select_dtypes(include='number').corr()

sns.heatmap(corr_data,annot=True)

plt.figure(figsize=(8,5))
sns.histplot(df['price'], bins=50, kde=True)
plt.title("Price Distribution")
plt.xlabel("Price")
plt.ylabel("Frequency")
plt.show()

"""Insights:

Distribution is right-skewed.

Majority of tickets are low‚Äìmid price, while few very expensive tickets drive revenue.

Revenue Actions:

Protect high-end prices (Business, Premium routes).

Use Economy volume to upsell higher classes
"""

df[['price']].agg(['min', 'mean', 'max'])

"""#### 1.check outlier"""

df["price"].describe()
outlier=df["price"]
print(outlier)

fig=px.box(df,y=outlier)
fig.show()

sns.histplot(data=df['price'] ,kde=True)

"""Insights:

Huge gap between Min and Max price.

Average price is much closer to Min than Max.

Revenue Actions:

Increase Average Ticket Price through bundles and upgrades instead of discounts.

## Understad Class
"""

df["class"]

df["class"].describe()

plt.title('type of classes')
type_class = df['class'].value_counts()

plt.pie(type_class, labels=type_class.index, autopct='%1.1f%%', colors = ["#003366","#cce6ff"])

plt.show()

avg_price_class = df.groupby('class')['price'].mean().reset_index()

sns.barplot(data=avg_price_class, x='class', y='price')
plt.title("Average Price by Class")
plt.show()

"""Insights:

Business class price is significantly higher than Economy.

Revenue is class-driven, not volume-driven.

Revenue Actions:

Expand Business Class capacity on high-demand routes.

Introduce ‚ÄúBusiness Lite‚Äù offerings

## airline_analysis
"""

plt.figure(figsize=(10,6))
sns.boxplot(data=df, x="airline", y="duration")
plt.xticks(rotation=45)
plt.title("Flight Duration by Airline")
plt.ylabel("Duration (minutes)")
plt.xlabel("Airline")
plt.show()

df['duration_group'] = pd.qcut(df['duration'], q=4, labels=["Short","Medium","Long","Very Long"])

avg_price_duration = df.groupby(['airline','duration_group'])['price'].mean().reset_index()

fig = px.bar(
    avg_price_duration,
    x='airline',
    y='price',
    color='duration_group',
    barmode='group',
    text='price',
    hover_data={'price': True, 'airline': True, 'duration_group': True},
    labels={'price':'Average Price', 'airline':'Airline', 'duration_group':'Duration Group'},
    title="Average Ticket Price per Airline by Duration Group"
)

fig.update_traces(
    texttemplate='%{text:.2f}',
    textposition='outside'
)

fig.update_layout(
    yaxis_title='Average Price',
    xaxis_title='Airline',
    legend_title='Duration Group'
)

fig.show()

"""Insights:

Vistara clearly positioned as a premium airline.

Budget airlines compete mainly on price

Revenue Actions:

Maintain premium pricing for strong brands.

Avoid price wars; focus on value-added services
"""

airline_share = df['airline'].value_counts().reset_index()
airline_share.columns = ['airline', 'flights']

px.pie(
    airline_share,
    names='airline',
    values='flights',
    title="Market Share by Airline"
)

"""Insights

One airline dominates the market.

Business class competition is weak

Revenue Actions

Leverage dominance to increase prices during peak demand.

Secure corporate contracts.
"""

avg_price_time = (
    df.groupby('departure_time')['price']
    .mean()
    .sort_values(ascending=False)
    .reset_index()
)

px.bar(
    avg_price_time,
    x='departure_time',
    y='price',
    title="Average Price by Departure Time"
)

"""Insights

Morning & Evening flights are the most expensive.

Late-night flights are cheapest

Revenue Actions

Increase prices in Morning/Evening slots.

Use Late Night for demand stimulation offers
"""

df['route'] = df['source_city'] + " - " + df['destination_city']

top_routes = df['route'].value_counts().head(10).reset_index()
top_routes.columns = ['route', 'flights']

sns.barplot(data=top_routes, y='route', x='flights')
plt.title("Top 10 Routes by Number of Flights")
plt.show()

"""Insights:

Metro-to-metro routes dominate flight volume.

Indicates strong business travel demand

Revenue Actions:

Premium pricing for business corridors.

Increase frequency during peak business hours
"""

avg_price_stops = (
    df.groupby('stops')['price']
    .mean()
    .reset_index()
)

sns.barplot(data=avg_price_stops, x='stops', y='price')
plt.title("Average Price by Number of Stops")
plt.show()

"""Insights:

Non-stop flights are significantly more expensive.

Stops are a major pricing factor.

Revenue Actions:

Position Non-stop as a premium option.

Market 1-stop flights as ‚ÄúBest Value.
"""

pivot_table = pd.pivot_table(
    df,
    values='price',
    index='departure_time',
    columns='class',
    aggfunc='mean'
)

sns.heatmap(pivot_table, annot=True, fmt=".0f", cmap="coolwarm")
plt.title("Avg Price by Class & Departure Time")
plt.show()

"""Insights:

Business + Morning/Evening = highest prices.

Economy prices are less sensitive to time.

Revenue Actions

Target business travelers with time-based pricing.

Optimize seat allocation by time slot.

## understad cities
"""

city_counts = df['source_city'].value_counts()
plt.figure(figsize=(8,5))
city_counts.plot(kind='bar')
plt.title(" source City Count")
plt.xlabel("source_city")
plt.ylabel("Count")
plt.xticks(rotation=45)
plt.show()

city_counts = df['destination_city'].value_counts()
plt.figure(figsize=(8,5))
city_counts.plot(kind='bar')
plt.title(" destination City Count")
plt.xlabel("destination_city")
plt.ylabel("Count")
plt.xticks(rotation=45)
plt.show()

"""
 #### Which city has the highest number of flights departing from it?
"""

counts = df.groupby(['source_city', 'destination_city']).size().reset_index(name='count')

fig = px.bar(
    counts,
    x="source_city",
    y="count",
    color="destination_city",
    barmode="group",
    title="Source City vs Destination City (Interactive)",
    hover_data=["source_city", "destination_city", "count"]
)

fig.update_layout(
    xaxis_title="Source City",
    yaxis_title="Number of Flights",
    legend_title="Destination City",
    bargap=0.17
)

fig.show()

"""## price analysing"""

def price_violin_hist(df):

    data = {
        "Category": [],
        "Value": [],
        "Average Price": []
    }

    groups = {
        "airline": "Average Price by Airline",
        "class": "Average Price by Class",
        "source_city": "Average Price by Source City",
        "destination_city": "Average Price by Destination City"
    }

    for col, title in groups.items():
        avg_prices = df.groupby(col)["price"].mean().round(2)
        for value, avg in avg_prices.items():
            data["Category"].append(col)
            data["Value"].append(value)
            data["Average Price"].append(avg)


    plt.figure(figsize=(10,5))
    sns.histplot(df["price"], kde=True, bins=30)
    plt.title("Price Histogram with KDE")
    plt.xlabel("Ticket Price")
    plt.ylabel("Frequency")
    plt.tight_layout()
    plt.show()

    result_df = pd.DataFrame(data)
    return result_df

result_df = price_violin_hist(df)
result_df

df.sample()

"""#### any correlation between daysleft and price?"""

def analysis_days_left(df):


    corr = df["days_left"].corr(df["price"])
    print(" Correlation between days_left and price:", corr)
    print()

    if corr < 0:
        print("if  days left is decrease -> price is increase")
    elif corr > 0:
        print("if  days left is increase -> price is decrease")
    else:
        print(" No correlation ")
    print()


    plt.figure(figsize=(10,5))
    line_data = df.groupby("days_left")["price"].mean().reset_index()
    sns.lineplot(x="days_left", y="price", data=line_data)
    plt.title("Average Price per Days Left")
    plt.xlabel("Days Left")
    plt.ylabel("Average Price")
    plt.show()

analysis_days_left(df)

df.groupby(["departure_time","stops"]).sum()[["price"]]

#  Pivot Table: average price for (Source ‚Üí Destination)
pivot_avg_price = pd.pivot_table(
    df,
    values="price",
    index="source_city",
    columns="destination_city",
    aggfunc="mean"
)



# average price on heatmap
plt.figure(figsize=(10, 6))
sns.heatmap(pivot_avg_price, annot=True, fmt=".0f", cmap="YlOrRd")
plt.title("Average Ticket Price Heatmap (Source ‚Üí Destination)")
plt.xlabel("Destination City")
plt.ylabel("Source City")
plt.show()

df.to_csv('cleaned_df.csv')

"""#Final Business Conclusion

üîπ Key Insights

Revenue is driven by Business Class, Peak Times, and Premium Routes.

Brand strength strongly influences price acceptance.

Customers trade off price vs convenience (time & stops).

üîπ Revenue Growth Strategy

Implement dynamic pricing models.

Upsell Economy passengers to Business.

Focus on high-margin segments instead of increasing volume.

Monetize peak demand and premium convenience

#Final Project Statement

Python was used to perform advanced exploratory data analysis, uncover pricing patterns, and support data-driven revenue optimization strategies prior to building interactive Power BI dashboards.

# Thank You for Reading
"""

